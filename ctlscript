#!/bin/bash

# Retrieves the real paths on the system from the structure of the files directory
getfiles()
{
	files=$(find files -type f)
	for item in $files; do
		name=${item//files/}
		if [[ "$name" =~ /home/(.*) ]]; then
			name="$HOME/${BASH_REMATCH[1]}"
		fi
		echo "$name"
	done
}

# Copy from the working folder to the system
if [ "$1" = "install" ]; then
	# Create a backup associated to the actual timestamp
	timestamp=$(date +%s)
	mkdir -p backup/"$timestamp"

	# Copy the respective file in the home directory making first a backup
	files=$(getfiles)
	for item in $files; do 
		if [ -f "$item" ]; then
			cp --parents $item backup/"$timestamp"/
		fi
		reponame=${item//$HOME/\/home}
		echo files"$reponame" "$item"
		#cp "$reponame" "$item"
	done
	exit
fi


# Copy from the system to the working folder
if [ "$1" = "update" ]; then
	files=$(getfiles)
	for item in $files; do
		reponame=${item//$HOME/\/home}
		cp "$item" files"$reponame" 
	done
	exit
fi


# Restore the system file form a backup
if [ "$1" = "restore" ]; then
	if [ ! -d backup/"$2" ]; then
		echo "Please choose a directory from the backup folder"
		exit
	fi
	files=$(find backup/$2 -type f)
	for item in $files; do
		name=${item#backup\/$2}
		cp "$item" "$name" 
	done
	exit
fi
